<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Demo</title>
    <!-- 请勿在项目正式环境中引用该 layui.css 地址 -->
    <link href="//unpkg.com/layui@2.8.18/dist/css/layui.css" rel="stylesheet">
    <style>
        .layui-form{
            padding-left : 10px;
            padding-top:20px;
        }

    </style>
</head>
<body>
    <form class="layui-form" action="">

        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">分组选择框</label>
                <div class="layui-input-inline">
                    <select name="exhibitionID" id="my-select">
                    </select>
                </div>
            </div>
        </div>
      
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">日期范围</label>
                <div class="layui-inline" id="ID-laydate-range">
                    <div class="layui-input-inline">
                        <input type="text" autocomplete="off" id="ID-laydate-start-date" class="layui-input" placeholder="开始日期" name="startDate" lay-verify="required">
                    </div>
                    <div class="layui-form-mid">-</div>
                    <div class="layui-input-inline">
                        <input type="text" autocomplete="off" id="ID-laydate-end-date" class="layui-input" placeholder="结束日期" name="endDate" lay-verify="required">
                    </div>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">时间范围</label>
                <div class="layui-input-inline">
                    <input type="text" class="layui-input" id="ID-laydate-range-time" placeholder=" - " name="timerange" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button type="submit" class="layui-btn" lay-submit lay-filter="demo1">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>

</form>

    <!-- 请勿在项目正式环境中引用该 layui.js 地址 -->
    <script src="//unpkg.com/layui@2.8.18/dist/layui.js"></script>
    <script src="lib/jquery/jquery-3.3.1.js"></script>
    <script>
        layui.use(['form', 'laydate', 'util'], function () {
            var form = layui.form;
            var layer = layui.layer;
            var laydate = layui.laydate;
            var util = layui.util;
            var exhidata = [];
            var currentExhibitionID = '';

            $.ajax({
                type: "get",
                url: "api/exhibition/Get?pageIndex=1&pageSize=20",
                dataType: "text",
                success: function (data) {
                    data = JSON.parse(data);
                    exhidata = data.items;
                    layui.$.each(exhidata, function (index, item) {
                        var option = new Option(item.description);
                        option.value = item.id;
                        currentExhibitionID = option.value;
                        layui.$('#my-select').append(option);
                    });
                    layui.form.render('select')
                },
                error: function (data) {
                    layer.alert(JSON.stringify(data), {
                        title: '当前填写的字段值'
                    });
                }
            });

            // 提交事件
            form.on('submit(demo1)', function (data) {
                var field = data.field; // 获取表单字段值
                var now = new Date().getTime();
                var startDate = new Date(field.startDate).getTime();
                var endDate = new Date(field.endDate).getTime();

                var startDay = fromDateToDay(now,startDate);
                var totalDay = fromDateToDay(startDate, endDate);

                if (field.timerange != null) {
                    var timeStart = field.timerange.split('-')[0].trim();
                    var timeEnd = field.timerange.split('-')[1].trim();
                }
                var json = JSON.stringify({
                    "dayStart": startDay,
                    "totalDay": totalDay,
                    "timeStart": timeStart,
                    "timeEnd": timeEnd,
                    "exhibitionID": field.exhibitionID
                });
                $.ajax({
                    type: "post",
                    url: "api/appointment/AddAppointments",
                    dataType: "json",
                    contentType: 'application/json;charset=utf-8',
                    data: json,
                    success: function (data) {
                        console.log(field.timerange)
                    },

                    error: function (data) {
                        layer.alert(JSON.stringify(data), {
                            title: '当前填写的字段值'
                        });
                    }
                });
                return false; // 阻止默认 form 跳转
            });
           
            // 日期范围 - 左右面板独立选择模式
            laydate.render({
                elem: '#ID-laydate-range',
                range: ['#ID-laydate-start-date', '#ID-laydate-end-date']
            });
            // 日期范围 - 左右面板联动选择模式
            laydate.render({
                elem: '#ID-laydate-rangeLinked',
                range: ['#ID-laydate-start-date-1', '#ID-laydate-end-date-1'],
                rangeLinked: true // 开启日期范围选择时的区间联动标注模式 ---  2.8+ 新增
            });
            // 时间范围
            laydate.render({
                elem: '#ID-laydate-range-time',
                type: "time",
                range: true,
                shortcuts: [
                    {
                        text: '09:30 <p style="text-align: center;">到</p> 11:30',
                        value: (function () {
                            var date1 = new Date();
                            date1.setHours(9, 0, 0, 0);
                            var date2 = new Date();
                            date2.setHours(11, 30, 0, 0);
                            return [date1, date2];
                        })
                    },
                    {
                        text: '13:00 <p style="text-align: center;">到</p> 15:00',
                        value: (function () {
                            var date1 = new Date();
                            date1.setHours(13, 0, 0, 0);
                            var date2 = new Date();
                            date2.setHours(15, 0, 0, 0);
                            return [date1, date2];
                        })
                    }
                ]
            });
        });

        function fromDateToDay(startDate, endDate) {
            var total = (endDate - startDate) / 1000;
            var day = Math.abs(Math.ceil(total / (24 * 60 * 60)));
            return day;
        }

    </script>

</body>
</html>